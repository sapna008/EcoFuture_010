/*
 * (C) 2023 MARS FLAG Corporation
 * http://www.marsflag.com/
 * Version: 0.0.5
 * Build Time: 2024/11/5 15:48:44
 */
"use strict";(()=>{var a={JSON_BASE_URL:"https://s.mp.marsflag.com/config",CE_BASE_URL:"https://ce.mf.marsflag.com"},r=(e,n=null)=>{let o={prefix:"color: yellow; background-color: black; font-size: 14px; font-weight: bold; padding: 2px;",message:"color: limegreen; background-color: black; font-size: 14px; padding: 2px;",data:"color: white; background-color: black; font-size: 14px; padding: 2px;"};console.log(`%cDEBUG: %c${e}`,o.prefix,o.message,n||"")},g=()=>{let e=document.querySelector("mf-search-results"),n=document.querySelector("mf-search-box");return(e==null?void 0:e.getAttribute("ajax-url"))||(n==null?void 0:n.getAttribute("ajax-url"))||null},f=e=>{let n=e.match(/documents\/(.+?)\/search/);return n?n[1]:null},p=()=>{let e=window.location.search+window.location.hash;return new URLSearchParams(e.slice(1)).get("force_version")},m=(e,n)=>new Promise((o,s)=>{let t=document.createElement("script");t.async=!0,t.type=n,t.src=e,t.onload=()=>{r("Script loaded:",e),o()},t.onerror=()=>{r("Failed to load script:",e),s(new Error(`Failed to load script: ${e}`))},document.body.appendChild(t)}),d=()=>m(`${a.CE_BASE_URL}/v1/js/mf-search.js`,"text/javascript"),E=()=>m(`${a.CE_BASE_URL}/v2/js/mf-search.js`,"module"),_=async e=>(await fetch(`${a.JSON_BASE_URL}/${e}.json`)).json(),v=(e,n,o)=>{var t,c,l,u;let s=o||((c=(t=e.mf3)==null?void 0:t.find(i=>i.unique_name===n))==null?void 0:c.setting.ce_version)||((u=(l=e.di)==null?void 0:l.find(i=>i.unique_name===n))==null?void 0:u.setting.ce_version)||"2";return Number(s)},w=async()=>{try{let e=g();if(!e)throw new Error("Element with ajax-url not found");r("Element with ajax-url found:",e);let n=f(e);if(!n)throw new Error(`Failed to get unique name from ajax-url: ${e}`);r("Unique Name:",n);let o=p();r("Forced version:",o||"Not forced");let s=await _(n);r("JSON Data:",s);let t=v(s,n,o);r("CE version:",t),t===1?(r("Loading v1 code",t),await d()):(r("Loading v2 code",t),await E())}catch(e){console.error("Error during initialization:",e),await d()}};w();})();
